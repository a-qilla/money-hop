<!DOCTYPE html>
<html lang="id" class="dark-theme">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Money Hop - {% block title %}{% endblock %}</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='images/logo.svg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    {% if session.user_id %}
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-brand">
                    <img src="{{ url_for('static', filename='images/logo.svg') }}" alt="Money Hop Logo" class="brand-logo">
                    <span class="brand-text">Money Hop</span>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div class="sidebar-content">
                <div class="sidebar-user">
                    <div class="user-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="user-info">
                        <div class="user-name">{{ session.username }}</div>
                        {% if session.email %}
                        <div class="user-email">{{ session.email }}</div>
                        {% endif %}
                        <div class="user-status">Online</div>
                    </div>
                </div>
                
                <nav class="sidebar-nav">
                    <a href="{{ url_for('dashboard') }}" class="nav-item {% if request.endpoint == 'dashboard' %}active{% endif %}">
                        <i class="fas fa-chart-line"></i>
                        <span class="nav-text">Dashboard</span>
                    </a>
                    
                    <!-- Siklus Akuntansi - Tahap Pencatatan -->
                    <div class="nav-section">Pencatatan Transaksi</div>
                    <a href="{{ url_for('cash_receipt') }}" class="nav-item {% if request.endpoint == 'cash_receipt' %}active{% endif %}">
                        <i class="fas fa-cash-register"></i>
                        <span class="nav-text">Cash Receipt</span>
                    </a>
                    
                    <a href="{{ url_for('cash_payment') }}" class="nav-item {% if request.endpoint == 'cash_payment' %}active{% endif %}">
                        <i class="fas fa-receipt"></i>
                        <span class="nav-text">Cash Payment</span>
                    </a>

                    <a href="{{ url_for('journal') }}" class="nav-item {% if request.endpoint == 'journal' %}active{% endif %}">
                        <i class="fas fa-book"></i>
                        <span class="nav-text">Jurnal Umum</span>
                    </a>

                    <!-- Siklus Akuntansi - Tahap Penggolongan -->
                    <div class="nav-section">Penggolongan & Buku Besar</div>
                    <a href="{{ url_for('coa') }}" class="nav-item {% if request.endpoint == 'coa' %}active{% endif %}">
                        <i class="fas fa-chart-bar"></i>
                        <span class="nav-text">Chart of Accounts</span>
                    </a>
                    
                    <a href="{{ url_for('add_account') }}" class="nav-item {% if request.endpoint == 'add_account' %}active{% endif %}">
                        <i class="fas fa-plus-circle"></i>
                        <span class="nav-text">Tambah Akun</span>
                    </a>
                    
                    <a href="{{ url_for('ledger') }}" class="nav-item {% if request.endpoint == 'ledger' %}active{% endif %}">
                        <i class="fas fa-book-open"></i>
                        <span class="nav-text">Buku Besar</span>
                    </a>

                    <!-- Siklus Akuntansi - Tahap Penyesuaian -->
                    <div class="nav-section">Penyesuaian & Neraca</div>
                    <a href="{{ url_for('trial_balance') }}" class="nav-item {% if request.endpoint == 'trial_balance' %}active{% endif %}">
                        <i class="fas fa-balance-scale"></i>
                        <span class="nav-text">Neraca Saldo</span>
                    </a>

                    <a href="{{ url_for('adjusting_entries') }}" class="nav-item {% if request.endpoint == 'adjusting_entries' %}active{% endif %}">
                        <i class="fas fa-adjust"></i>
                        <span class="nav-text">Jurnal Penyesuaian</span>
                    </a>

                    <!-- Siklus Akuntansi - Tahap Pelaporan -->
                    <div class="nav-section">Pelaporan Keuangan</div>
                    <a href="{{ url_for('reports') }}" class="nav-item {% if request.endpoint == 'reports' %}active{% endif %}">
                        <i class="fas fa-file-alt"></i>
                        <span class="nav-text">Laporan Keuangan</span>
                    </a>
                    
                    <!-- Siklus Akuntansi - Tahap Penutupan -->
                    <div class="nav-section">Penutupan</div>
                    <a href="{{ url_for('closing_entries') }}" class="nav-item {% if request.endpoint == 'closing_entries' %}active{% endif %}">
                        <i class="fas fa-lock"></i>
                        <span class="nav-text">Jurnal Penutup</span>
                    </a>

                    <a href="{{ url_for('post_closing_trial_balance') }}" class="nav-item {% if request.endpoint == 'post_closing_trial_balance' %}active{% endif %}">
                        <i class="fas fa-lock"></i>
                        <span class="nav-text">Neraca Saldo Penutup</span>
                    </a>

                    <!-- Modul Tambahan -->
                    <div class="nav-section">Manajemen</div>
                    <a href="{{ url_for('inventory') }}" class="nav-item {% if request.endpoint == 'inventory' %}active{% endif %}">
                        <i class="fas fa-boxes"></i>
                        <span class="nav-text">Inventory</span>
                    </a>

                </nav>
            </div>
            
            <div class="sidebar-footer">
                <a href="{{ url_for('logout') }}" class="nav-item logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="nav-text">Logout</span>
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <div class="top-nav">
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="top-nav-right">
                    <span class="welcome-text">
                        Halo, {{ session.username }}
                        {% if session.email %}
                        <span style="color: var(--text-muted);">({{ session.email }})</span>
                        {% endif %}
                    </span>
                </div>
            </div>

            <div class="content-wrapper">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'error' if category == 'error' else 'success' }}">
                                <i class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'check-circle' }}"></i>
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                {% block content %}{% endblock %}
            </div>
        </div>
    </div>
    {% else %}
    <!-- For non-authenticated users (login/register pages) -->
    <div class="auth-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'error' if category == 'error' else 'success' }}">
                        <i class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'check-circle' }}"></i>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block auth_content %}{% endblock %}
    </div>
    {% endif %}

    <script>
        // Sidebar Toggle Functionality
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const menuToggle = document.getElementById('menuToggle');
            
            // Toggle sidebar collapse/expand
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('collapsed');
                    
                    // Update icon
                    const icon = this.querySelector('i');
                    if (sidebar.classList.contains('collapsed')) {
                        icon.className = 'fas fa-chevron-right';
                    } else {
                        icon.className = 'fas fa-bars';
                    }
                    
                    // Save state to localStorage
                    localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
                });
            }
            
            // Mobile menu toggle
            if (menuToggle) {
                menuToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('show');
                });
            }
            
            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', function(event) {
                if (window.innerWidth <= 768 && sidebar.classList.contains('show')) {
                    if (!sidebar.contains(event.target) && !menuToggle.contains(event.target)) {
                        sidebar.classList.remove('show');
                    }
                }
            });
            
            // Restore sidebar state from localStorage
            const sidebarCollapsed = localStorage.getItem('sidebarCollapsed');
            if (sidebarCollapsed === 'true' && sidebarToggle) {
                sidebar.classList.add('collapsed');
                const icon = sidebarToggle.querySelector('i');
                icon.className = 'fas fa-chevron-right';
            }
            
            // Auto-hide sidebar on mobile when navigating
            if (window.innerWidth <= 768) {
                const navItems = document.querySelectorAll('.nav-item');
                navItems.forEach(item => {
                    item.addEventListener('click', () => {
                        sidebar.classList.remove('show');
                    });
                });
            }
        });
        
    </script>
</body>
</html>